import{c as l,a as i,F as f,r as b,o as c,n as L,t as _,C as $,A as w,p as C,b as A,D as V,i as D,d as S,e as u,f as h,g as P,L as O,P as E,h as F,j as H,T as x,k as j,l as N,m as y,q as B,s as I}from"./vendor-DPnwuyEA.js";import{E as g}from"./env-BgNWCqfq.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}})();const p=(e,t)=>{const n=e.__vccOpts||e;for(const[o,s]of t)n[o]=s;return n},R={name:"AddonList",props:["addonData","currentAddon","currentFilter"],emits:["changeSorting","addonClicked","filterChanged"]},T={class:"mb-3 d-flex justify-content-between"},W=["value"],q={class:"dropdown"},z={class:"dropdown-menu dropdown-menu-end","aria-labelledby":"sortingButton"},M={class:"list-scroll overflow-auto"},J={class:"list-group"},U=["onClick"];function K(e,t,n,o,s,r){return c(),l(f,null,[i("div",T,[i("div",null,[i("input",{type:"search",class:"form-control",id:"addon-filter",placeholder:"Filter",value:this.currentFilter,onInput:t[0]||(t[0]=a=>e.$emit("filterChanged",a.target.value))},null,40,W)]),i("div",q,[t[5]||(t[5]=i("button",{class:"btn btn-secondary dropdown-toggle",type:"button",id:"sortingButton","data-bs-toggle":"dropdown","aria-expanded":"false"}," Addon Sorting ",-1)),i("ul",z,[i("li",{onClick:t[1]||(t[1]=a=>e.$emit("changeSorting","name"))},t[3]||(t[3]=[i("a",{class:"dropdown-item",href:"#"},"Name",-1)])),i("li",{onClick:t[2]||(t[2]=a=>e.$emit("changeSorting","total"))},t[4]||(t[4]=[i("a",{class:"dropdown-item",href:"#"},"Total Installations",-1)]))])])]),i("div",M,[i("ul",J,[(c(!0),l(f,null,b(n.addonData,a=>(c(),l("li",{class:L(["list-group-item",{active:a.name===n.currentAddon.name}]),key:a.name,onClick:d=>e.$emit("addonClicked",a.name)},_(a.name),11,U))),128))])])],64)}const G=p(R,[["render",K]]),Q={name:"NumberDisplayWidget",props:["values"]},X={class:"card"},Y={class:"card-body row"},Z={class:"d-flex flex-column justify-content-evenly align-items-center h-100"},tt={class:"h5"};function et(e,t,n,o,s,r){return c(),l("div",X,[i("div",Y,[(c(!0),l(f,null,b(this.values,a=>(c(),l("div",{class:"col",key:a},[i("div",Z,[i("span",tt,_(a.title),1),i("span",null,_(a.value),1)])]))),128))])])}const st=p(Q,[["render",et]]);$.register(w,C,A);const ot={name:"VersionsChart",props:["versions"],components:{Doughnut:V},data(){return{chartOptions:{responsive:!0,maintainAspectRatio:!1,borderColor:"#121213",plugins:{legend:{position:"right"}}}}},computed:{chartData(){if(this.versions===void 0||this.versions.length===0)return{labels:[],datasets:[]};const e=Object.keys(this.versions).map(s=>[s,this.versions[s]]).sort((s,r)=>{const a=this.cleanVersion(s[0]),d=this.cleanVersion(r[0]);return S(a,d)}),t=[],n=[];for(const s of e)t.push(s[0]),n.push(s[1]);const o=this.generateColors(t.length);return{labels:t,datasets:[{backgroundColor:o,data:n}]}}},methods:{generateColors(e){const s=.96/e;let r;const a=[];for(let d=0;d<e;d++)r=.04+d*s,a.push(D(r));return a},cleanVersion(e){return e.replace(/^([\d\\.]+(?:-.+)?)(?:\w.+)?$/,"$1")}}},nt={class:"card"},rt={class:"card-body"},at={class:"chart-container"};function it(e,t,n,o,s,r){const a=h("Doughnut");return c(),l("div",nt,[i("div",rt,[t[0]||(t[0]=i("h5",{class:"card-title"},"Latest installations grouped by version",-1)),i("div",at,[u(a,{data:r.chartData,options:s.chartOptions},null,8,["data","options"])])])])}const dt=p(ot,[["render",it]]);$.register(P,O,E,F,H,C,A,x);const lt={name:"HistoryChart",props:["versions"],components:{LineChart:j},data(){return{chartOptions:{tension:.1,responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}},scales:{x:{type:"time",time:{unit:"day",round:"day",tooltipFormat:"yyyy-MM-dd"}},y:{title:{display:!0,text:"Installations"}}}}}},computed:{sortedVersions(){return Object.keys(this.versions).map(e=>[e,this.versions[e]]).sort((e,t)=>{const n=this.cleanVersion(e[0]),o=this.cleanVersion(t[0]);return S(n,o)})},chartData(){if(this.versions===void 0||this.versions.length===0)return{labels:[],datasets:[]};const e=new Set;for(const n of this.sortedVersions)for(const o of Object.keys(n[1]))e.add(o);const t=[];for(const n of this.sortedVersions){const o=[];for(const s of Array.from(e))o.push(n[1][s]);t.push({label:n[0],backgroundColor:this.chartColors[n[0]],borderColor:this.chartColors[n[0]],data:o})}return{labels:Array.from(e),datasets:t}},chartColors(){const e=this.generateColors(this.sortedVersions.length),t=this.sortedVersions.map(o=>o[0]),n={};return t.forEach((o,s)=>{n[o]=e[s]}),n}},methods:{generateColors(e){const s=.96/e;let r;const a=[];for(let d=0;d<e;d++)r=.04+d*s,a.push(D(r));return a},cleanVersion(e){return e.replace(/^([\d\\.]+(?:-.+)?)(?:\w.+)?$/,"$1")}}},ct={class:"card"},ut={class:"card-body"},ht={class:"chart-container"};function pt(e,t,n,o,s,r){const a=h("LineChart");return c(),l("div",ct,[i("div",ut,[t[0]||(t[0]=i("h5",{class:"card-title"},"Installations over time",-1)),i("div",ht,[u(a,{data:r.chartData,options:s.chartOptions},null,8,["data","options"])])])])}const mt=p(lt,[["render",pt]]),ft={name:"AddonDetails",components:{HistoryChart:mt,VersionsChart:dt,NumberDisplayWidget:st},props:["addonDetails","addonHistory"],computed:{numberDisplay(){return[{title:"Total Installations",value:this.addonDetails.total},{title:"Auto-Update enabled",value:this.addonDetails.auto_update},{title:"In protected environment",value:this.addonDetails.protected}]}}},_t={class:"col"},vt={class:"row mb-2"},gt={class:"row mb-3"},yt={class:"row mb-3"},bt={class:"row"};function $t(e,t,n,o,s,r){const a=h("NumberDisplayWidget"),d=h("VersionsChart"),v=h("HistoryChart");return c(),l("div",_t,[i("div",vt,[i("h2",null,_(n.addonDetails.name),1)]),i("div",gt,[u(a,{values:r.numberDisplay},null,8,["values"])]),i("div",yt,[u(d,{versions:n.addonDetails.versions},null,8,["versions"])]),i("div",bt,[u(v,{versions:n.addonHistory},null,8,["versions"])])])}const Ct=p(ft,[["render",$t],["__scopeId","data-v-2563ae6f"]]),At={name:"HeaderBar"},Dt={class:"navbar bg-secondary fixed-top mb-4"};function St(e,t,n,o,s,r){return c(),l("nav",Dt,t[0]||(t[0]=[N('<div class="container"><a class="navbar-brand" href="#"><span class="mdi mdi-home-analytics"></span>Home Assistant Addon Stats</a><div><a href="https://github.com/Poeschl/homeassistant-addon-stats"><span class="mdi mdi-github single"></span></a></div></div>',1)]))}const kt=p(At,[["render",St]]),Lt={data(){return{addons:{},addon_version_history:{},currentAddon:{},sorting:"total",filter:""}},inject:{plausible:{default:void 0}},methods:{loadAddonData(){Promise.all([fetch("/addons.json",{method:"get"}),fetch("/version_history.json",{method:"get"})]).then(e=>{this.onDataLoaded(e)}).catch(e=>{console.error("Error on retrieving data",e)})},onDataLoaded(e){const t=e[0].json(),n=e[1].json();Promise.all([t.then(o=>{for(const s in o)o[s].name=s;this.addons=o}),n.then(o=>{this.addon_version_history=o})]).then(()=>{this.checkForFilterParam(),this.addonClicked(Object.keys(this.reactiveAddons)[0])})},addonClicked(e){this.currentAddon=this.addons[e],this.plausible!==void 0&&this.plausible.trackEvent("addon clicked",{props:{addon:e}})},checkForFilterParam(){let e=window.location.search,t=new URLSearchParams(e);t.has("filter")&&(this.filter=t.get("filter"),this.plausible!==void 0&&this.plausible.trackEvent("used filter",{props:{filter:this.filter}}))}},computed:{addonsLoaded(){return this.addons!==void 0&&Object.keys(this.addons).length>0},addonHistory(){return this.addon_version_history[this.currentAddon.name]},reactiveAddons(){let e;this.sorting==="total"?e=(o,s)=>s.total-o.total:this.sorting==="name"&&(e=(o,s)=>o.name<s.name?-1:o.name>s.name?1:0);let t=Object.values(this.addons).filter(o=>o.name.includes(this.filter)).sort(e);const n={};for(const o of t)n[o.name]=o;return n}},components:{HeaderBar:kt,AddonList:G,AddonDetails:Ct},mounted(){this.loadAddonData()}},wt={class:"container"},Vt={key:0,class:"row"},Pt={class:"col-4"},Ot={class:"col-8"},Et={key:1,class:"text-center"};function Ft(e,t,n,o,s,r){const a=h("HeaderBar"),d=h("AddonList"),v=h("AddonDetails");return c(),l(f,null,[u(a),i("div",wt,[r.addonsLoaded?(c(),l("div",Vt,[i("div",Pt,[u(d,{"addon-data":this.reactiveAddons,"current-addon":this.currentAddon,"current-filter":this.filter,onAddonClicked:t[0]||(t[0]=m=>r.addonClicked(m)),onChangeSorting:t[1]||(t[1]=m=>this.sorting=m),onFilterChanged:t[2]||(t[2]=m=>this.filter=m)},null,8,["addon-data","current-addon","current-filter"])]),i("div",Ot,[u(v,{"addon-details":this.currentAddon,"addon-history":this.addonHistory},null,8,["addon-details","addon-history"])])])):y("",!0),r.addonsLoaded?y("",!0):(c(),l("div",Et,t[3]||(t[3]=[i("div",{class:"spinner-border text-primary d-inline-block",role:"status"},[i("span",{class:"visually-hidden"},"Loading...")],-1)])))])],64)}const Ht=p(Lt,[["render",Ft]]),k=B(Ht);if(g.plausibleDomain.length>0){const e=I({domain:g.plausibleDomain,apiHost:g.plausibleCustomApiHost});e.enableAutoPageviews(),k.provide("plausible",e)}k.mount("#app");
